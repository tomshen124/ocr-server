# OCR智能预审系统完整文档

## 📋 系统概述

OCR智能预审系统是一个基于Rust后端和政务风格前端的文档智能审核平台，支持6个真实政务事项的自动化预审。

### 支持事项
- 工程渣土准运证核准 (101104353)
- 工程渣土消纳场地登记 (101306405)
- 排水接管技术审查 (101102043)
- 临时占用、挖掘河道设施许可 (101304025)
- 设置其他户外广告设施和招牌、指示牌备案 (101105083)
- 利用广场等公共场所举办文化、商业等活动许可 (101303167)

## 🏗️ 系统架构

### 架构层次
```
┌─────────────────────────────────────────────────────────────┐
│                        用户层                                │
│  第三方系统    │    政务用户    │    测试工具                │
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                        接入层                                │
│     SSO认证服务     │     负载均衡     │     API网关         │
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                        应用层                                │
│  REST API服务  │  认证中间件  │  静态文件服务                │
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                        业务层                                │
│  预审服务  │  OCR识别服务  │  规则引擎  │  事项映射          │
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                        数据层                                │
│    SQLite数据库    │    文件存储    │    配置文件            │
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                       外部服务                               │
│      Zen规则引擎      │      模拟OCR服务                     │
└─────────────────────────────────────────────────────────────┘
```

### 核心组件

#### 后端服务 (Rust)
- **端口**: 31101
- **数据库**: SQLite
- **认证**: SSO + AK/SK双重认证
- **异步处理**: Tokio异步运行时

#### 前端界面 (政务风格)
- **技术栈**: HTML5 + CSS3 + JavaScript
- **设计风格**: 政务蓝色主题，左右分栏布局
- **响应式**: 支持PC和移动端

#### 外部集成
- **OCR服务**: 模拟OCR识别引擎
- **规则引擎**: Zen决策引擎
- **SSO认证**: 第三方单点登录

## 🔄 业务流程

### 完整业务流程
```
第三方系统 → 后端API → OCR服务 → 规则引擎 → 数据库 → 政务用户 → 前端界面

1. 数据提交阶段:
   第三方系统 --[AK/SK认证]--> 后端API
   后端API --[验证事项映射]--> 数据库
   后端API --[返回预审ID和URL]--> 第三方系统

2. 异步处理阶段:
   后端API --[异步OCR识别]--> OCR服务
   OCR服务 --[返回识别结果]--> 后端API
   后端API --[调用规则引擎]--> 规则引擎
   规则引擎 --[返回审核结果]--> 后端API
   后端API --[更新预审状态]--> 数据库

3. 用户访问阶段:
   政务用户 --[访问预审URL]--> 后端API
   后端API --[SSO身份验证]--> 后端API
   后端API --[重定向到前端]--> 前端界面

4. 结果展示阶段:
   前端界面 --[获取预审数据]--> 后端API
   后端API --[查询预审结果]--> 数据库
   数据库 --[返回完整数据]--> 后端API
   后端API --[返回结构化结果]--> 前端界面
   前端界面 --[展示政务风格界面]--> 政务用户
```

### 数据流转
```
输入数据:
├── 第三方请求数据
├── 用户文件
└── 事项信息

处理流程:
├── 事项映射
├── OCR识别
├── 规则引擎
└── 结果生成

存储层:
├── 预审记录
├── 文件存储
└── 处理日志

输出结果:
├── 预审ID
├── 访问URL
├── 审核结果
└── 政务界面
```

## 📡 关键API接口

### 第三方数据提交
```http
POST /api/preview
Authorization: AK/SK
Content-Type: application/json

{
  "requestId": "unique_request_id",
  "matterId": "101104353", 
  "matterName": "工程渣土准运证核准",
  "agentInfo": {
    "userId": "1472176",
    "userName": "张三"
  },
  "files": [...]
}
```

### 用户访问入口
```http
GET /api/preview/view/{preview_id}
→ 302 重定向到 /static/index.html?previewId={id}&verified=true
```

### 预审结果获取
```http
GET /api/preview/result/{preview_id}
Cookie: session_id=xxx

Response: {
  "success": true,
  "data": {
    "preview_id": "PREVIEW_001",
    "applicant_name": "张三",
    "matter_name": "工程渣土准运证核准",
    "materials": [...],
    "summary": {...}
  }
}
```

## 🎯 部署和运行

### 启动服务
```bash
# 启动服务
./scripts/ocr-server.sh start

# 停止服务  
./scripts/ocr-server.sh stop

# 查看状态
./scripts/ocr-server.sh status
```

### 访问地址
- **测试工具**: http://localhost:31101/static/test-tools.html
- **预审界面**: http://localhost:31101/static/index.html
- **监控中心**: http://localhost:31101/static/monitoring.html

## 🧪 测试流程

### 快速测试
1. 访问测试工具
2. 点击"快速测试（含登录）"
3. 自动完成：登录→提交→处理→展示

### 完整测试
1. 选择测试场景（6个事项之一）
2. 点击"测试完整流程"
3. 验证政务风格界面展示

### 测试覆盖
- ✅ 认证流程测试
- ✅ 数据提交测试  
- ✅ OCR处理测试
- ✅ 规则引擎测试
- ✅ 前端界面测试
- ✅ 用户交互测试

## 📊 事项映射配置

| 事项名称 | 事项ID | 主题ID | 优先级 |
|---------|--------|--------|--------|
| 工程渣土准运证核准 | 101104353 | theme_001 | 3 |
| 工程渣土消纳场地登记 | 101306405 | theme_002 | 1 |
| 排水接管技术审查 | 101102043 | theme_003 | 1 |
| 临时占用、挖掘河道设施许可 | 101304025 | theme_004 | 1 |
| 设置其他户外广告设施和招牌、指示牌备案 | 101105083 | theme_005 | 1 |
| 利用广场等公共场所举办文化、商业等活动许可 | 101303167 | theme_006 | 1 |

## 🔧 技术特性

### 后端特性
- **高性能**: Rust异步编程，支持高并发
- **安全认证**: 双重认证机制，确保数据安全
- **智能匹配**: 事项智能映射，支持模糊匹配
- **异步处理**: OCR和规则引擎异步执行

### 前端特性
- **政务风格**: 专业的政务系统UI设计
- **响应式布局**: 适配PC和移动设备
- **实时交互**: 材料选择和视图切换
- **状态管理**: 完整的加载和错误处理

### 系统特性
- **模块化设计**: 组件解耦，易于维护
- **配置驱动**: 事项映射和规则可配置
- **完整测试**: 端到端测试覆盖
- **监控支持**: 系统状态和性能监控

---

*文档版本: v1.0*  
*更新时间: 2024-07-25*
