<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>预审演示工具 - Debug环境</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 20px; color: #333;
        }
        
        .container {
            max-width: 1200px; margin: 0 auto; background: white;
            border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 30px; text-align: center;
        }
        .header h1 { font-size: 28px; margin-bottom: 10px; font-weight: 700; }
        .header p { opacity: 0.9; font-size: 16px; }
        
        .demo-banner {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            color: #2d3436; padding: 20px; text-align: center;
            border-bottom: 3px solid #e17055;
        }
        .demo-banner strong { font-size: 18px; display: block; margin-bottom: 5px; }
        
        .content { padding: 30px; }
        
        .demo-controls {
            background: #f8f9fa; border-radius: 12px; padding: 25px;
            margin-bottom: 30px; border: 2px solid #e9ecef;
        }
        .controls-title {
            font-size: 20px; font-weight: 700; color: #2c3e50;
            margin-bottom: 20px; display: flex; align-items: center;
        }
        .controls-title .icon { margin-right: 10px; }
        
        .form-row {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px; margin-bottom: 20px;
        }
        
        .form-group { margin-bottom: 15px; }
        .form-group label {
            display: block; margin-bottom: 8px; font-weight: 600;
            color: #495057; font-size: 14px;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%; padding: 12px; border: 2px solid #e9ecef;
            border-radius: 8px; font-size: 14px; transition: all 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none; border-color: #667eea; 
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            background: #667eea; color: white; border: none;
            padding: 12px 24px; border-radius: 8px; font-size: 14px;
            font-weight: 600; cursor: pointer; margin-right: 10px;
            margin-bottom: 10px; transition: all 0.3s ease;
            display: inline-flex; align-items: center; gap: 8px;
        }
        .btn:hover { background: #5a67d8; transform: translateY(-2px); }
        .btn:disabled {
            background: #6c757d; cursor: not-allowed; transform: none;
        }
        .btn.success { background: #28a745; }
        .btn.success:hover { background: #1e7e34; }
        .btn.warning { background: #ffc107; color: #212529; }
        .btn.warning:hover { background: #e0a800; }
        .btn.danger { background: #dc3545; }
        .btn.danger:hover { background: #c82333; }
        
        .demo-area {
            border: 2px solid #e9ecef; border-radius: 12px; 
            background: white; overflow: hidden;
        }
        .demo-header {
            background: #f8f9fa; padding: 20px; border-bottom: 2px solid #e9ecef;
            display: flex; justify-content: space-between; align-items: center;
        }
        .demo-content {
            height: 600px; position: relative;
        }
        .demo-iframe {
            width: 100%; height: 100%; border: none;
        }
        
        .status-panel {
            background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 12px;
            padding: 25px; margin-bottom: 20px;
        }
        .status-indicator {
            width: 12px; height: 12px; border-radius: 50%;
            display: inline-block; margin-right: 8px;
        }
        .status-ready { background: #6c757d; }
        .status-loading { background: #ffc107; animation: pulse 1.5s infinite; }
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .preview-tabs {
            display: flex; background: #f8f9fa; margin-bottom: 20px;
        }
        .preview-tab {
            padding: 12px 20px; cursor: pointer; border: none; background: none;
            font-size: 14px; font-weight: 600; color: #6c757d;
            border-bottom: 3px solid transparent; transition: all 0.3s ease;
            flex: 1; text-align: center;
        }
        .preview-tab.active {
            color: #667eea; border-bottom-color: #667eea; background: white;
        }
        .preview-tab:hover { color: #667eea; }
        
        .scenario-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }
        .scenario-card {
            background: white; border: 2px solid #e9ecef; border-radius: 12px;
            padding: 20px; cursor: pointer; transition: all 0.3s ease;
        }
        .scenario-card:hover {
            border-color: #667eea; transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.15);
        }
        .scenario-card.active { border-color: #667eea; background: #f0f4ff; }
        .scenario-title { font-weight: 700; margin-bottom: 10px; color: #2c3e50; }
        .scenario-desc { font-size: 13px; color: #6c757d; margin-bottom: 15px; }
        .scenario-params { font-size: 12px; color: #495057; }
        
        .message { padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .message.success {
            background: #d4edda; color: #155724; border: 1px solid #c3e6cb;
        }
        .message.error {
            background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;
        }
        .message.info {
            background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb;
        }
        
        .loading-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.9); z-index: 10;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column;
        }
        .loading-spinner {
            width: 40px; height: 40px; border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea; border-radius: 50%;
            animation: spin 1s linear infinite; margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <div class="header">
            <h1>📋 预审演示工具</h1>
            <p>完整的预审流程演示，支持多种场景模拟和实时预览</p>
        </div>

        <!-- 演示横幅 -->
        <div class="demo-banner">
            <strong>🎭 演示环境</strong>
            <p>此工具提供预审流程的完整演示，包含真实的表单交互和流程控制</p>
        </div>

        <div class="content">
            <!-- 状态消息 -->
            <div id="statusMessage"></div>

            <!-- 演示控制台 -->
            <div class="demo-controls">
                <div class="controls-title">
                    <span class="icon">🎮</span>
                    演示控制台
                </div>
                
                <!-- 预审场景选择 -->
                <div class="form-group">
                    <label>选择预审场景</label>
                    <div id="scenarioGrid" class="scenario-grid">
                        <!-- 动态生成场景卡片 -->
                    </div>
                </div>
                
                <!-- 表单参数配置 -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="matterCode">事项代码</label>
                        <input type="text" id="matterCode" placeholder="输入事项代码">
                    </div>
                    <div class="form-group">
                        <label for="applierType">申请人类型</label>
                        <select id="applierType">
                            <option value="individual">个人</option>
                            <option value="enterprise">企业</option>
                            <option value="organization">组织机构</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="previewMode">预审模式</label>
                        <select id="previewMode">
                            <option value="standard">标准预审</option>
                            <option value="quick">快速预审</option>
                            <option value="comprehensive">全面预审</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="themeId">主题ID</label>
                        <input type="text" id="themeId" placeholder="可选的主题ID">
                    </div>
                </div>
                
                <!-- 操作按钮 -->
                <div style="margin-top: 20px;">
                    <button class="btn" onclick="startDemo()" id="startDemoBtn">
                        🚀 启动演示
                    </button>
                    <button class="btn success" onclick="openProductionPreview()">
                        🏭 生产环境预览
                    </button>
                    <button class="btn warning" onclick="resetDemo()">
                        🔄 重置演示
                    </button>
                    <button class="btn" onclick="exportConfig()">
                        📥 导出配置
                    </button>
                    <button class="btn" onclick="importConfig()">
                        📤 导入配置
                    </button>
                </div>
            </div>

            <!-- 状态面板 -->
            <div class="status-panel">
                <div class="controls-title">
                    <span class="icon">📊</span>
                    演示状态
                </div>
                <p>
                    当前状态：
                    <span id="demoStatusIndicator" class="status-indicator status-ready"></span>
                    <span id="demoStatusText">准备就绪</span>
                </p>
                <p id="currentScenario" style="margin-top: 10px; color: #6c757d;">
                    请选择一个预审场景开始演示
                </p>
            </div>

            <!-- 预览标签页 -->
            <div class="preview-tabs">
                <button class="preview-tab active" onclick="switchPreviewTab('demo')">
                    🎭 演示预览
                </button>
                <button class="preview-tab" onclick="switchPreviewTab('mobile')">
                    📱 移动端视图
                </button>
                <button class="preview-tab" onclick="switchPreviewTab('config')">
                    ⚙️ 配置预览
                </button>
                <button class="preview-tab" onclick="switchPreviewTab('log')">
                    📋 操作日志
                </button>
            </div>

            <!-- 演示区域 -->
            <div class="demo-area">
                <div class="demo-header">
                    <h3 id="demoTitle">预审演示</h3>
                    <div>
                        <button class="btn" onclick="refreshDemo()">🔄 刷新</button>
                        <button class="btn" onclick="fullscreenDemo()">🔍 全屏</button>
                    </div>
                </div>
                <div class="demo-content" id="demoContent">
                    <!-- 默认加载页面 -->
                    <div id="loadingOverlay" class="loading-overlay hidden">
                        <div class="loading-spinner"></div>
                        <p>正在加载演示...</p>
                    </div>
                    
                    <!-- 演示iframe -->
                    <iframe id="demoIframe" class="demo-iframe" src="/static/prod/index.html"></iframe>
                    
                    <!-- 配置预览 -->
                    <div id="configPreview" class="hidden" style="padding: 20px; height: 100%; overflow-y: auto;">
                        <pre id="configContent" style="background: #f8f9fa; padding: 20px; border-radius: 8px; font-size: 12px;"></pre>
                    </div>
                    
                    <!-- 操作日志 -->
                    <div id="logPreview" class="hidden" style="padding: 20px; height: 100%; overflow-y: auto;">
                        <div id="logContent" style="background: #2d3748; color: #e2e8f0; padding: 20px; border-radius: 8px; font-family: monospace; font-size: 12px; height: 100%; overflow-y: auto;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 隐藏的文件输入 -->
    <input type="file" id="configFileInput" accept=".json" class="hidden">

    <!-- 引入配置文件 -->
    <script src="../assets/test-config.js"></script>
    <script>
        // 全局状态
        let currentScenario = null;
        let demoConfig = null;
        let operationLog = [];
        let currentPreviewTab = 'demo';

        // 预审场景配置
        const previewScenarios = [
            {
                id: 'individual_license',
                title: '个人执照申请',
                description: '个人申请营业执照的标准流程',
                params: {
                    matterCode: 'GYYYZZ001',
                    applierType: 'individual',
                    previewMode: 'standard'
                }
            },
            {
                id: 'enterprise_registration',
                title: '企业注册登记',
                description: '企业法人注册登记完整流程',
                params: {
                    matterCode: 'QYZCDJ001',
                    applierType: 'enterprise',
                    previewMode: 'comprehensive'
                }
            },
            {
                id: 'permit_application',
                title: '许可证申请',
                description: '各类行政许可证申请流程',
                params: {
                    matterCode: 'XKZSQ001',
                    applierType: 'enterprise',
                    previewMode: 'standard'
                }
            },
            {
                id: 'quick_service',
                title: '快速办理服务',
                description: '简化流程的快速办理演示',
                params: {
                    matterCode: 'KSBL001',
                    applierType: 'individual',
                    previewMode: 'quick'
                }
            },
            {
                id: 'organization_service',
                title: '组织机构服务',
                description: '社会组织、事业单位相关服务',
                params: {
                    matterCode: 'ZZJG001',
                    applierType: 'organization',
                    previewMode: 'standard'
                }
            },
            {
                id: 'special_procedure',
                title: '特殊审批程序',
                description: '需要特殊审批流程的复杂事项',
                params: {
                    matterCode: 'TSSP001',
                    applierType: 'enterprise',
                    previewMode: 'comprehensive'
                }
            }
        ];

        // 页面初始化
        document.addEventListener('DOMContentLoaded', () => {
            console.log('📋 预审演示工具初始化...');
            initializeScenarios();
            initializeFileInput();
            logOperation('系统初始化', '预审演示工具已启动');
            showMessage('预审演示工具已就绪，请选择场景开始演示', 'info');
        });

        // 初始化场景网格
        function initializeScenarios() {
            const scenarioGrid = document.getElementById('scenarioGrid');
            
            scenarioGrid.innerHTML = previewScenarios.map(scenario => `
                <div class="scenario-card" onclick="selectScenario('${scenario.id}')">
                    <div class="scenario-title">${scenario.title}</div>
                    <div class="scenario-desc">${scenario.description}</div>
                    <div class="scenario-params">
                        事项: ${scenario.params.matterCode} | 
                        类型: ${scenario.params.applierType} | 
                        模式: ${scenario.params.previewMode}
                    </div>
                </div>
            `).join('');
        }

        // 选择场景
        function selectScenario(scenarioId) {
            const scenario = previewScenarios.find(s => s.id === scenarioId);
            if (!scenario) return;
            
            currentScenario = scenario;
            
            // 更新卡片选中状态
            document.querySelectorAll('.scenario-card').forEach(card => {
                card.classList.remove('active');
            });
            event.target.closest('.scenario-card').classList.add('active');
            
            // 更新表单参数
            document.getElementById('matterCode').value = scenario.params.matterCode;
            document.getElementById('applierType').value = scenario.params.applierType;
            document.getElementById('previewMode').value = scenario.params.previewMode;
            
            // 更新状态显示
            document.getElementById('currentScenario').textContent = 
                `已选择场景: ${scenario.title}`;
            
            logOperation('场景选择', `选择了场景: ${scenario.title}`);
            showMessage(`已选择场景: ${scenario.title}`, 'success');
        }

        // 启动演示
        async function startDemo() {
            if (!currentScenario) {
                showMessage('请先选择一个预审场景', 'error');
                return;
            }
            
            const startBtn = document.getElementById('startDemoBtn');
            const statusIndicator = document.getElementById('demoStatusIndicator');
            const statusText = document.getElementById('demoStatusText');
            
            startBtn.disabled = true;
            startBtn.innerHTML = '🔄 启动中...';
            statusIndicator.className = 'status-indicator status-loading';
            statusText.textContent = '正在启动演示...';
            
            try {
                // 收集配置参数
                demoConfig = {
                    scenario: currentScenario,
                    matterCode: document.getElementById('matterCode').value,
                    applierType: document.getElementById('applierType').value,
                    previewMode: document.getElementById('previewMode').value,
                    themeId: document.getElementById('themeId').value,
                    timestamp: new Date().toISOString()
                };
                
                logOperation('演示启动', '开始启动预审演示', demoConfig);
                
                // 显示加载覆盖层
                document.getElementById('loadingOverlay').classList.remove('hidden');
                
                // 构建演示URL
                const params = new URLSearchParams({
                    demo: 'true',
                    scenario: currentScenario.id,
                    matter: demoConfig.matterCode,
                    applier_type: demoConfig.applierType,
                    mode: demoConfig.previewMode
                });
                
                if (demoConfig.themeId) {
                    params.append('theme', demoConfig.themeId);
                }
                
                const demoUrl = `/static/prod/index.html?${params.toString()}`;
                
                // 更新iframe源
                const iframe = document.getElementById('demoIframe');
                iframe.src = demoUrl;
                
                // 等待iframe加载
                iframe.onload = () => {
                    setTimeout(() => {
                        document.getElementById('loadingOverlay').classList.add('hidden');
                        statusIndicator.className = 'status-indicator status-success';
                        statusText.textContent = '演示运行中';
                        document.getElementById('demoTitle').textContent = 
                            `预审演示 - ${currentScenario.title}`;
                        
                        logOperation('演示就绪', '预审演示已成功启动');
                        showMessage('预审演示已启动，可以开始操作', 'success');
                    }, 1000);
                };
                
                // 更新配置预览
                updateConfigPreview();
                
            } catch (error) {
                statusIndicator.className = 'status-indicator status-error';
                statusText.textContent = '启动失败';
                
                logOperation('演示错误', '演示启动失败', { error: error.message });
                showMessage(`演示启动失败: ${error.message}`, 'error');
            } finally {
                startBtn.disabled = false;
                startBtn.innerHTML = '🚀 启动演示';
            }
        }

        // 切换预览标签
        function switchPreviewTab(tabName) {
            // 更新标签状态
            document.querySelectorAll('.preview-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // 隐藏所有内容
            document.getElementById('demoIframe').style.display = 'none';
            document.getElementById('configPreview').classList.add('hidden');
            document.getElementById('logPreview').classList.add('hidden');
            
            // 显示对应内容
            switch (tabName) {
                case 'demo':
                case 'mobile':
                    document.getElementById('demoIframe').style.display = 'block';
                    if (tabName === 'mobile') {
                        // 模拟移动端视图
                        document.getElementById('demoIframe').style.width = '375px';
                        document.getElementById('demoIframe').style.margin = '0 auto';
                        document.getElementById('demoContent').style.background = '#f0f0f0';
                    } else {
                        document.getElementById('demoIframe').style.width = '100%';
                        document.getElementById('demoIframe').style.margin = '0';
                        document.getElementById('demoContent').style.background = 'white';
                    }
                    break;
                case 'config':
                    document.getElementById('configPreview').classList.remove('hidden');
                    updateConfigPreview();
                    break;
                case 'log':
                    document.getElementById('logPreview').classList.remove('hidden');
                    updateLogPreview();
                    break;
            }
            
            currentPreviewTab = tabName;
            logOperation('标签切换', `切换到标签页: ${tabName}`);
        }

        // 更新配置预览
        function updateConfigPreview() {
            const configContent = document.getElementById('configContent');
            if (demoConfig) {
                configContent.textContent = JSON.stringify(demoConfig, null, 2);
            } else {
                configContent.textContent = '暂无配置信息，请先启动演示';
            }
        }

        // 更新日志预览
        function updateLogPreview() {
            const logContent = document.getElementById('logContent');
            logContent.innerHTML = operationLog.map(log => 
                `<div style="margin-bottom: 10px;">
                    <span style="color: #81e6d9;">[${log.timestamp}]</span> 
                    <span style="color: #f6e05e;">${log.operation}</span>: 
                    ${log.description}
                    ${log.data ? `<br><span style="color: #cbd5e0; font-size: 11px;">${JSON.stringify(log.data)}</span>` : ''}
                </div>`
            ).reverse().join('');
            
            // 滚动到底部
            logContent.scrollTop = logContent.scrollHeight;
        }

        // 记录操作日志
        function logOperation(operation, description, data = null) {
            const logEntry = {
                timestamp: new Date().toLocaleTimeString(),
                operation: operation,
                description: description,
                data: data
            };
            
            operationLog.push(logEntry);
            
            // 如果当前在日志标签页，更新显示
            if (currentPreviewTab === 'log') {
                updateLogPreview();
            }
            
            DebugConfig.utils.log(operation, 'info', { description, data });
        }

        // 打开生产环境预览
        function openProductionPreview() {
            const url = '/static/prod/index.html';
            window.open(url, '_blank');
            logOperation('外部打开', '打开生产环境预览');
        }

        // 重置演示
        function resetDemo() {
            currentScenario = null;
            demoConfig = null;
            
            // 重置表单
            document.getElementById('matterCode').value = '';
            document.getElementById('applierType').value = 'individual';
            document.getElementById('previewMode').value = 'standard';
            document.getElementById('themeId').value = '';
            
            // 重置选中状态
            document.querySelectorAll('.scenario-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // 重置状态
            document.getElementById('demoStatusIndicator').className = 'status-indicator status-ready';
            document.getElementById('demoStatusText').textContent = '准备就绪';
            document.getElementById('currentScenario').textContent = '请选择一个预审场景开始演示';
            document.getElementById('demoTitle').textContent = '预审演示';
            
            // 重置iframe
            document.getElementById('demoIframe').src = '/static/prod/index.html';
            
            logOperation('系统重置', '演示环境已重置');
            showMessage('演示环境已重置', 'info');
        }

        // 刷新演示
        function refreshDemo() {
            const iframe = document.getElementById('demoIframe');
            iframe.src = iframe.src;
            logOperation('演示刷新', '重新加载演示页面');
        }

        // 全屏演示
        function fullscreenDemo() {
            const demoContent = document.getElementById('demoContent');
            if (demoContent.requestFullscreen) {
                demoContent.requestFullscreen();
                logOperation('全屏模式', '切换到全屏演示模式');
            }
        }

        // 导出配置
        function exportConfig() {
            if (!demoConfig) {
                showMessage('暂无配置可导出，请先启动演示', 'error');
                return;
            }
            
            const configJson = JSON.stringify(demoConfig, null, 2);
            const blob = new Blob([configJson], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `preview-demo-config-${new Date().getTime()}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            logOperation('配置导出', '演示配置已导出到文件');
            showMessage('配置已导出到文件', 'success');
        }

        // 导入配置
        function importConfig() {
            document.getElementById('configFileInput').click();
        }

        // 初始化文件输入
        function initializeFileInput() {
            document.getElementById('configFileInput').onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const config = JSON.parse(e.target.result);
                        
                        // 应用配置
                        if (config.scenario) {
                            selectScenario(config.scenario.id);
                        }
                        
                        document.getElementById('matterCode').value = config.matterCode || '';
                        document.getElementById('applierType').value = config.applierType || 'individual';
                        document.getElementById('previewMode').value = config.previewMode || 'standard';
                        document.getElementById('themeId').value = config.themeId || '';
                        
                        logOperation('配置导入', '已导入演示配置', config);
                        showMessage('配置导入成功', 'success');
                        
                    } catch (error) {
                        logOperation('导入错误', '配置文件格式错误', { error: error.message });
                        showMessage('配置文件格式错误', 'error');
                    }
                };
                reader.readAsText(file);
            };
        }

        // 显示消息
        function showMessage(message, type = 'info') {
            const messageContainer = document.getElementById('statusMessage');
            messageContainer.innerHTML = `
                <div class="message ${type}">
                    ${message}
                </div>
            `;
            
            setTimeout(() => {
                messageContainer.innerHTML = '';
            }, 3000);
        }
    </script>
</body>
</html> 