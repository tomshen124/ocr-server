<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIÊµãËØïÂ∑•ÂÖ∑ - DebugÁéØÂ¢É</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 20px; color: #333;
        }
        
        .container {
            max-width: 1200px; margin: 0 auto; background: white;
            border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 30px; text-align: center;
        }
        .header h1 { font-size: 28px; margin-bottom: 10px; font-weight: 700; }
        .header p { opacity: 0.9; font-size: 16px; }
        
        .nav-tabs {
            display: flex; background: #f8f9fa; border-bottom: 2px solid #e9ecef;
        }
        .tab {
            padding: 15px 25px; cursor: pointer; border: none; background: none;
            font-size: 14px; font-weight: 600; color: #6c757d;
            border-bottom: 3px solid transparent; transition: all 0.3s ease;
        }
        .tab.active {
            color: #667eea; border-bottom-color: #667eea; background: white;
        }
        .tab:hover { color: #667eea; background: #f8f9fa; }
        
        .content { padding: 30px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .form-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 30px;
            margin-bottom: 30px;
        }
        
        .form-section {
            background: #f8f9fa; border-radius: 12px; padding: 25px;
            border: 2px solid #e9ecef;
        }
        .section-title {
            font-size: 18px; font-weight: 700; color: #2c3e50;
            margin-bottom: 20px; display: flex; align-items: center;
        }
        .section-title .icon { margin-right: 10px; }
        
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block; margin-bottom: 8px; font-weight: 600;
            color: #495057; font-size: 14px;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%; padding: 12px; border: 2px solid #e9ecef;
            border-radius: 8px; font-size: 14px; transition: all 0.3s ease;
            font-family: inherit;
        }
        .form-group textarea {
            resize: vertical; min-height: 120px;
            font-family: 'Monaco', 'Courier New', monospace;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none; border-color: #667eea; 
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            background: #667eea; color: white; border: none;
            padding: 12px 24px; border-radius: 8px; font-size: 14px;
            font-weight: 600; cursor: pointer; margin-right: 10px;
            margin-bottom: 10px; transition: all 0.3s ease;
            display: inline-flex; align-items: center; gap: 8px;
        }
        .btn:hover { background: #5a67d8; transform: translateY(-2px); }
        .btn:disabled {
            background: #6c757d; cursor: not-allowed; transform: none;
        }
        .btn.success { background: #28a745; }
        .btn.success:hover { background: #1e7e34; }
        .btn.warning { background: #ffc107; color: #212529; }
        .btn.warning:hover { background: #e0a800; }
        .btn.danger { background: #dc3545; }
        .btn.danger:hover { background: #c82333; }
        
        .result-panel {
            background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 12px;
            padding: 25px; margin-top: 20px;
        }
        .result-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #dee2e6;
        }
        .result-content {
            font-family: 'Monaco', 'Courier New', monospace; font-size: 13px;
            background: #2d3748; color: #e2e8f0; padding: 20px;
            border-radius: 8px; white-space: pre-wrap; overflow-x: auto;
            max-height: 400px; overflow-y: auto;
        }
        
        .quick-tests {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px; margin-bottom: 30px;
        }
        .quick-test {
            background: white; border: 2px solid #e9ecef; border-radius: 8px;
            padding: 20px; cursor: pointer; transition: all 0.3s ease;
            text-align: center;
        }
        .quick-test:hover {
            border-color: #667eea; transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        .quick-test-title { font-weight: 700; margin-bottom: 8px; }
        .quick-test-desc { font-size: 12px; color: #6c757d; }
        .quick-test-method {
            display: inline-block; padding: 4px 8px; border-radius: 4px;
            font-size: 10px; font-weight: 600; margin-top: 8px;
        }
        .method-GET { background: #d4edda; color: #155724; }
        .method-POST { background: #cce5ff; color: #004085; }
        .method-PUT { background: #fff3cd; color: #856404; }
        .method-DELETE { background: #f8d7da; color: #721c24; }
        
        .status-indicator {
            width: 10px; height: 10px; border-radius: 50%;
            display: inline-block; margin-right: 8px;
        }
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-loading { background: #ffc107; animation: pulse 1.5s infinite; }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .file-drop-area {
            border: 2px dashed #dee2e6; border-radius: 8px; padding: 30px;
            text-align: center; cursor: pointer; transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        .file-drop-area:hover, .file-drop-area.dragover {
            border-color: #667eea; background: #f0f4ff;
        }
        .file-drop-area.has-file {
            border-color: #28a745; background: #d4edda;
        }
        
        .file-info {
            display: flex; align-items: center; justify-content: space-between;
            background: #e9ecef; padding: 10px; border-radius: 6px;
            margin-top: 10px;
        }
        
        .hidden { display: none !important; }
        
        .message { padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .message.success {
            background: #d4edda; color: #155724; border: 1px solid #c3e6cb;
        }
        .message.error {
            background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;
        }
        .message.info {
            background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Â§¥ÈÉ® -->
        <div class="header">
            <h1>üîå APIÊµãËØïÂ∑•ÂÖ∑</h1>
            <p>ÂÖ®Èù¢ÁöÑAPIÊé•Âè£ÊµãËØïÂπ≥Âè∞ÔºåÊîØÊåÅRESTful APIÂíåÊñá‰ª∂‰∏ä‰º†ÊµãËØï</p>
        </div>

        <!-- ÂØºËà™Ê†áÁ≠æ -->
        <div class="nav-tabs">
            <button class="tab active" onclick="switchTab('manual-test')">ÊâãÂä®ÊµãËØï</button>
            <button class="tab" onclick="switchTab('quick-test')">Âø´ÈÄüÊµãËØï</button>
            <button class="tab" onclick="switchTab('preview-test')">È¢ÑÂÆ°ÊµãËØï</button>
            <button class="tab" onclick="switchTab('upload-test')">Êñá‰ª∂‰∏ä‰º†</button>
            <button class="tab" onclick="switchTab('batch-test')">ÊâπÈáèÊµãËØï</button>
        </div>

        <div class="content">
            <!-- Áä∂ÊÄÅÊ∂àÊÅØ -->
            <div id="statusMessage"></div>

            <!-- ÊâãÂä®ÊµãËØï -->
            <div id="manual-test" class="tab-content active">
                <div class="form-grid">
                    <div class="form-section">
                        <div class="section-title">
                            <span class="icon">‚öôÔ∏è</span>
                            ËØ∑Ê±ÇÈÖçÁΩÆ
                        </div>
                        
                        <div class="form-group">
                            <label for="method">ËØ∑Ê±ÇÊñπÊ≥ï</label>
                            <select id="method">
                                <option value="GET">GET</option>
                                <option value="POST" selected>POST</option>
                                <option value="PUT">PUT</option>
                                <option value="DELETE">DELETE</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="url">ËØ∑Ê±ÇURL</label>
                            <input type="text" id="url" placeholder="ËæìÂÖ•APIÁ´ØÁÇπ (Â¶Ç: /api/preview/create)">
                        </div>
                        
                        <div class="form-group">
                            <label for="headers">ËØ∑Ê±ÇÂ§¥ (JSONÊ†ºÂºè)</label>
                            <textarea id="headers" placeholder='{"Content-Type": "application/json"}'></textarea>
                        </div>
                        
                        <button class="btn" onclick="sendManualRequest()" id="sendBtn">
                            üöÄ ÂèëÈÄÅËØ∑Ê±Ç
                        </button>
                        <button class="btn warning" onclick="clearManualForm()">
                            üßπ Ê∏ÖÁ©∫Ë°®Âçï
                        </button>
                    </div>
                    
                    <div class="form-section">
                        <div class="section-title">
                            <span class="icon">üìù</span>
                            ËØ∑Ê±Ç‰Ωì
                        </div>
                        
                        <div class="form-group">
                            <label for="body">ËØ∑Ê±Ç‰Ωì (JSONÊ†ºÂºè)</label>
                            <textarea id="body" placeholder='{"key": "value"}' style="min-height: 200px;"></textarea>
                        </div>
                        
                        <button class="btn warning" onclick="formatJSON()">
                            ‚ú® Ê†ºÂºèÂåñJSON
                        </button>
                        <button class="btn" onclick="loadExample()">
                            üìã Âä†ËΩΩÁ§∫‰æã
                        </button>
                    </div>
                </div>
                
                <div class="result-panel">
                    <div class="result-header">
                        <h3>üìä ÂìçÂ∫îÁªìÊûú</h3>
                        <div>
                            <span id="responseStatus" class="status-indicator"></span>
                            <span id="responseStatusText">ÂáÜÂ§áÂ∞±Áª™</span>
                        </div>
                    </div>
                    <div id="responseContent" class="result-content">Á≠âÂæÖÂèëÈÄÅËØ∑Ê±Ç...</div>
                </div>
            </div>

            <!-- Âø´ÈÄüÊµãËØï -->
            <div id="quick-test" class="tab-content">
                <div class="section-title">
                    <span class="icon">‚ö°</span>
                    Âø´ÈÄüAPIÊµãËØï
                </div>
                <p style="color: #6c757d; margin-bottom: 20px;">
                    ÁÇπÂáª‰∏ãÊñπÈ¢ÑËÆæÁöÑÊµãËØïÁî®‰æãÔºåÂø´ÈÄüÈ™åËØÅÂ∏∏Áî®APIÊé•Âè£
                </p>
                
                <div id="quickTests" class="quick-tests">
                    <!-- Âä®ÊÄÅÁîüÊàêÂø´ÈÄüÊµãËØïÈÄâÈ°π -->
                </div>
                
                <div class="result-panel">
                    <div class="result-header">
                        <h3>üìä Âø´ÈÄüÊµãËØïÁªìÊûú</h3>
                        <div>
                            <span id="quickResponseStatus" class="status-indicator"></span>
                            <span id="quickResponseStatusText">ÈÄâÊã©ÊµãËØïÁî®‰æã</span>
                        </div>
                    </div>
                    <div id="quickResponseContent" class="result-content">ÈÄâÊã©‰∏äÊñπÁöÑÊµãËØïÁî®‰æãÂºÄÂßãÊµãËØï...</div>
                </div>
            </div>

            <!-- È¢ÑÂÆ°ÊµãËØï -->
            <div id="preview-test" class="tab-content">
                <div class="form-grid">
                    <div class="form-section">
                        <div class="section-title">
                            <span class="icon">üìã</span>
                            È¢ÑÂÆ°ÊµÅÁ®ãÊµãËØï
                        </div>
                        
                        <div class="form-group">
                            <label for="previewType">È¢ÑÂÆ°Á±ªÂûã</label>
                            <select id="previewType">
                                <option value="general">‰∏ÄËà¨È¢ÑÂÆ°</option>
                                <option value="special">ÁâπÊÆäÈ¢ÑÂÆ°</option>
                                <option value="urgent">Á¥ßÊÄ•È¢ÑÂÆ°</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="matter">‰∫ãÈ°π‰ª£Á†Å</label>
                            <input type="text" id="matter" placeholder="ËæìÂÖ•‰∫ãÈ°π‰ª£Á†Å">
                        </div>
                        
                        <div class="form-group">
                            <label for="applierType">Áî≥ËØ∑‰∫∫Á±ªÂûã</label>
                            <select id="applierType">
                                <option value="individual">‰∏™‰∫∫</option>
                                <option value="enterprise">‰ºÅ‰∏ö</option>
                                <option value="organization">ÁªÑÁªáÊú∫ÊûÑ</option>
                            </select>
                        </div>
                        
                        <button class="btn" onclick="createPreviewTest()">
                            üìã ÂàõÂª∫È¢ÑÂÆ°
                        </button>
                        <button class="btn success" onclick="queryPreviewTest()">
                            üîç Êü•ËØ¢È¢ÑÂÆ°
                        </button>
                    </div>
                    
                    <div class="form-section">
                        <div class="section-title">
                            <span class="icon">üéØ</span>
                            ÊµãËØïÁä∂ÊÄÅ
                        </div>
                        
                        <div class="form-group">
                            <label for="previewId">È¢ÑÂÆ°ID</label>
                            <input type="text" id="previewId" placeholder="ËæìÂÖ•ÊàñÁîüÊàêÈ¢ÑÂÆ°ID">
                        </div>
                        
                        <div id="previewTestStatus" style="margin-top: 20px;">
                            <p>Á≠âÂæÖÂàõÂª∫ÊàñÊü•ËØ¢È¢ÑÂÆ°...</p>
                        </div>
                        
                        <button class="btn warning" onclick="pollPreviewStatus()">
                            üîÑ ËΩÆËØ¢Áä∂ÊÄÅ
                        </button>
                        <button class="btn danger" onclick="stopPolling()">
                            ‚èπÔ∏è ÂÅúÊ≠¢ËΩÆËØ¢
                        </button>
                    </div>
                </div>
                
                <div class="result-panel">
                    <div class="result-header">
                        <h3>üìä È¢ÑÂÆ°ÊµãËØïÁªìÊûú</h3>
                    </div>
                    <div id="previewResponseContent" class="result-content">Á≠âÂæÖÊâßË°åÈ¢ÑÂÆ°ÊµãËØï...</div>
                </div>
            </div>

            <!-- Êñá‰ª∂‰∏ä‰º†ÊµãËØï -->
            <div id="upload-test" class="tab-content">
                <div class="form-grid">
                    <div class="form-section">
                        <div class="section-title">
                            <span class="icon">üìÅ</span>
                            Êñá‰ª∂‰∏ä‰º†ÊµãËØï
                        </div>
                        
                        <div id="fileDropArea" class="file-drop-area">
                            <p>üìÅ ÊãñÊãΩÊñá‰ª∂Âà∞Ê≠§Â§ÑÊàñÁÇπÂáªÈÄâÊã©Êñá‰ª∂</p>
                            <p style="color: #6c757d; font-size: 12px; margin-top: 10px;">
                                ÊîØÊåÅÂõæÁâáÊ†ºÂºè: JPG, PNG, PDFÁ≠â
                            </p>
                        </div>
                        <input type="file" id="fileInput" class="hidden" multiple 
                               accept=".jpg,.jpeg,.png,.pdf,.doc,.docx">
                        
                        <div id="fileList"></div>
                        
                        <div class="form-group">
                            <label for="uploadEndpoint">‰∏ä‰º†Á´ØÁÇπ</label>
                            <select id="uploadEndpoint">
                                <option value="/api/ocr/upload">OCRÊñá‰ª∂‰∏ä‰º†</option>
                                <option value="/api/preview/upload">È¢ÑÂÆ°Êñá‰ª∂‰∏ä‰º†</option>
                                <option value="/api/attachment/upload">ÈôÑ‰ª∂‰∏ä‰º†</option>
                            </select>
                        </div>
                        
                        <button class="btn" onclick="uploadFiles()" id="uploadBtn">
                            üì§ ‰∏ä‰º†Êñá‰ª∂
                        </button>
                        <button class="btn warning" onclick="clearFiles()">
                            üóëÔ∏è Ê∏ÖÁ©∫Êñá‰ª∂
                        </button>
                    </div>
                    
                    <div class="form-section">
                        <div class="section-title">
                            <span class="icon">‚öôÔ∏è</span>
                            ‰∏ä‰º†ÈÖçÁΩÆ
                        </div>
                        
                        <div class="form-group">
                            <label for="uploadParams">È¢ùÂ§ñÂèÇÊï∞ (JSON)</label>
                            <textarea id="uploadParams" placeholder='{"description": "ÊµãËØï‰∏ä‰º†"}'></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>‰∏ä‰º†ÈÄâÈ°π</label>
                            <div style="margin-top: 10px;">
                                <label style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <input type="checkbox" id="autoOCR" style="margin-right: 8px;">
                                    Ëá™Âä®ÊâßË°åOCRËØÜÂà´
                                </label>
                                <label style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <input type="checkbox" id="asyncProcess" style="margin-right: 8px;">
                                    ÂºÇÊ≠•Â§ÑÁêÜ
                                </label>
                                <label style="display: flex; align-items: center;">
                                    <input type="checkbox" id="keepOriginal" style="margin-right: 8px;" checked>
                                    ‰øùÁïôÂéüÂßãÊñá‰ª∂
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="result-panel">
                    <div class="result-header">
                        <h3>üìä ‰∏ä‰º†ÁªìÊûú</h3>
                        <div id="uploadProgress" class="hidden">
                            <progress id="progressBar" max="100" value="0"></progress>
                            <span id="progressText">0%</span>
                        </div>
                    </div>
                    <div id="uploadResponseContent" class="result-content">ÈÄâÊã©Êñá‰ª∂Âπ∂ÈÖçÁΩÆÂèÇÊï∞ÂêéÂºÄÂßã‰∏ä‰º†...</div>
                </div>
            </div>

            <!-- ÊâπÈáèÊµãËØï -->
            <div id="batch-test" class="tab-content">
                <div class="section-title">
                    <span class="icon">üìä</span>
                    ÊâπÈáèAPIÊµãËØï
                </div>
                <p style="color: #6c757d; margin-bottom: 20px;">
                    ÊâßË°åÈ¢ÑÂÆö‰πâÁöÑÊµãËØïÂ•ó‰ª∂ÔºåÊâπÈáèÈ™åËØÅAPIÁöÑÁ®≥ÂÆöÊÄßÂíåÊÄßËÉΩ
                </p>
                
                <div class="form-section">
                    <div class="form-group">
                        <label for="testSuite">ÊµãËØïÂ•ó‰ª∂</label>
                        <select id="testSuite">
                            <option value="basic">Âü∫Á°ÄÂäüËÉΩÊµãËØï</option>
                            <option value="auth">ËÆ§ËØÅÊµãËØï</option>
                            <option value="preview">È¢ÑÂÆ°ÊµÅÁ®ãÊµãËØï</option>
                            <option value="ocr">OCRÂäüËÉΩÊµãËØï</option>
                            <option value="stress">ÂéãÂäõÊµãËØï</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="testCount">ÊµãËØïÊ¨°Êï∞</label>
                        <input type="number" id="testCount" value="5" min="1" max="100">
                    </div>
                    
                    <div class="form-group">
                        <label for="testInterval">ÊµãËØïÈó¥Èöî (Áßí)</label>
                        <input type="number" id="testInterval" value="1" min="0" max="60" step="0.1">
                    </div>
                    
                    <button class="btn" onclick="runBatchTest()" id="batchTestBtn">
                        üöÄ ÂºÄÂßãÊâπÈáèÊµãËØï
                    </button>
                    <button class="btn danger" onclick="stopBatchTest()">
                        ‚èπÔ∏è ÂÅúÊ≠¢ÊµãËØï
                    </button>
                </div>
                
                <div class="result-panel">
                    <div class="result-header">
                        <h3>üìä ÊâπÈáèÊµãËØïÁªìÊûú</h3>
                        <div>
                            <span id="batchProgress">ÂáÜÂ§áÂ∞±Áª™</span>
                        </div>
                    </div>
                    <div id="batchResponseContent" class="result-content">ÈÖçÁΩÆÂèÇÊï∞ÂêéÂºÄÂßãÊâπÈáèÊµãËØï...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÂºïÂÖ•ÈÖçÁΩÆÊñá‰ª∂ -->
    <script src="../assets/test-config.js"></script>
    <script>
        // ÂÖ®Â±ÄÁä∂ÊÄÅ
        let selectedFiles = [];
        let pollingInterval = null;
        let batchTestRunning = false;
        let batchTestAborted = false;

        // È°µÈù¢ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üîå APIÊµãËØïÂ∑•ÂÖ∑ÂàùÂßãÂåñ...');
            initializeQuickTests();
            initializeFileUpload();
            loadDefaultHeaders();
            showMessage('APIÊµãËØïÂ∑•ÂÖ∑Â∑≤Â∞±Áª™', 'info');
        });

        // Ê†áÁ≠æÂàáÊç¢
        function switchTab(tabName) {
            // Êõ¥Êñ∞Ê†áÁ≠æÁä∂ÊÄÅ
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Êõ¥Êñ∞ÂÜÖÂÆπÊòæÁ§∫
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            DebugConfig.utils.log(`ÂàáÊç¢Âà∞Ê†áÁ≠æÈ°µ: ${tabName}`, 'info');
        }

        // ÂàùÂßãÂåñÂø´ÈÄüÊµãËØï
        function initializeQuickTests() {
            const container = document.getElementById('quickTests');
            const tests = DebugConfig.apiTests.quickTests;
            
            container.innerHTML = '';
            
            tests.forEach((test, index) => {
                const testElement = document.createElement('div');
                testElement.className = 'quick-test';
                testElement.onclick = () => runQuickTest(test);
                testElement.innerHTML = `
                    <div class="quick-test-title">${test.name}</div>
                    <div class="quick-test-desc">${test.description}</div>
                    <div class="quick-test-method method-${test.method}">${test.method}</div>
                `;
                container.appendChild(testElement);
            });
        }

        // Âä†ËΩΩÈªòËÆ§ËØ∑Ê±ÇÂ§¥
        function loadDefaultHeaders() {
            const headers = {
                "Content-Type": "application/json",
                "Accept": "application/json"
            };
            document.getElementById('headers').value = JSON.stringify(headers, null, 2);
        }

        // ÂèëÈÄÅÊâãÂä®ËØ∑Ê±Ç
        async function sendManualRequest() {
            const sendBtn = document.getElementById('sendBtn');
            const statusIndicator = document.getElementById('responseStatus');
            const statusText = document.getElementById('responseStatusText');
            const responseContent = document.getElementById('responseContent');
            
            // Á¶ÅÁî®ÊåâÈíÆÂπ∂Êõ¥Êñ∞Áä∂ÊÄÅ
            sendBtn.disabled = true;
            sendBtn.innerHTML = 'üîÑ ÂèëÈÄÅ‰∏≠...';
            statusIndicator.className = 'status-indicator status-loading';
            statusText.textContent = 'ÂèëÈÄÅËØ∑Ê±Ç‰∏≠...';
            
            try {
                // Êî∂ÈõÜËØ∑Ê±ÇÂèÇÊï∞
                const method = document.getElementById('method').value;
                const url = document.getElementById('url').value;
                const headersText = document.getElementById('headers').value;
                const bodyText = document.getElementById('body').value;
                
                if (!url) {
                    throw new Error('ËØ∑Ê±ÇURL‰∏çËÉΩ‰∏∫Á©∫');
                }
                
                // Ëß£ÊûêËØ∑Ê±ÇÂ§¥
                let headers = {};
                if (headersText.trim()) {
                    headers = JSON.parse(headersText);
                }
                
                // ÊûÑÂª∫ËØ∑Ê±ÇÈÄâÈ°π
                const options = {
                    method: method,
                    headers: headers,
                    credentials: 'include'
                };
                
                // Ê∑ªÂä†ËØ∑Ê±Ç‰ΩìÔºàGETËØ∑Ê±ÇÈô§Â§ñÔºâ
                if (method !== 'GET' && bodyText.trim()) {
                    options.body = bodyText;
                }
                
                const startTime = Date.now();
                DebugConfig.utils.log('ÂèëÈÄÅAPIËØ∑Ê±Ç', 'info', { method, url, headers, body: bodyText });
                
                // ÂèëÈÄÅËØ∑Ê±Ç
                const response = await fetch(url, options);
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                // ËØªÂèñÂìçÂ∫î
                const responseText = await response.text();
                let responseData;
                try {
                    responseData = JSON.parse(responseText);
                } catch {
                    responseData = responseText;
                }
                
                // Êõ¥Êñ∞Áä∂ÊÄÅ
                if (response.ok) {
                    statusIndicator.className = 'status-indicator status-success';
                    statusText.textContent = `ÊàêÂäü (${response.status}) - ${duration}ms`;
                } else {
                    statusIndicator.className = 'status-indicator status-error';
                    statusText.textContent = `Â§±Ë¥• (${response.status}) - ${duration}ms`;
                }
                
                // ÊòæÁ§∫ÂìçÂ∫îÁªìÊûú
                const result = {
                    status: response.status,
                    statusText: response.statusText,
                    headers: Object.fromEntries(response.headers.entries()),
                    duration: `${duration}ms`,
                    data: responseData
                };
                
                responseContent.textContent = JSON.stringify(result, null, 2);
                
                DebugConfig.utils.log('Êî∂Âà∞APIÂìçÂ∫î', response.ok ? 'info' : 'error', result);
                
            } catch (error) {
                statusIndicator.className = 'status-indicator status-error';
                statusText.textContent = 'ËØ∑Ê±ÇÂ§±Ë¥•';
                responseContent.textContent = `ÈîôËØØ: ${error.message}`;
                
                DebugConfig.utils.log('APIËØ∑Ê±ÇÂ§±Ë¥•', 'error', error);
            } finally {
                sendBtn.disabled = false;
                sendBtn.innerHTML = 'üöÄ ÂèëÈÄÅËØ∑Ê±Ç';
            }
        }

        // ËøêË°åÂø´ÈÄüÊµãËØï
        async function runQuickTest(test) {
            const statusIndicator = document.getElementById('quickResponseStatus');
            const statusText = document.getElementById('quickResponseStatusText');
            const responseContent = document.getElementById('quickResponseContent');
            
            statusIndicator.className = 'status-indicator status-loading';
            statusText.textContent = `Ê≠£Âú®ÊµãËØï: ${test.name}`;
            
            try {
                const startTime = Date.now();
                
                // ÊûÑÂª∫ËØ∑Ê±ÇÈÄâÈ°π
                const options = {
                    method: test.method,
                    headers: test.headers || { 'Content-Type': 'application/json' },
                    credentials: 'include'
                };
                
                if (test.body && test.method !== 'GET') {
                    options.body = typeof test.body === 'string' ? test.body : JSON.stringify(test.body);
                }
                
                const response = await fetch(test.url, options);
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                const responseText = await response.text();
                let responseData;
                try {
                    responseData = JSON.parse(responseText);
                } catch {
                    responseData = responseText;
                }
                
                // Êõ¥Êñ∞Áä∂ÊÄÅ
                if (response.ok) {
                    statusIndicator.className = 'status-indicator status-success';
                    statusText.textContent = `‚úÖ ${test.name} - ÊàêÂäü (${response.status}) - ${duration}ms`;
                } else {
                    statusIndicator.className = 'status-indicator status-error';
                    statusText.textContent = `‚ùå ${test.name} - Â§±Ë¥• (${response.status}) - ${duration}ms`;
                }
                
                const result = {
                    test: test.name,
                    status: response.status,
                    statusText: response.statusText,
                    headers: Object.fromEntries(response.headers.entries()),
                    duration: `${duration}ms`,
                    data: responseData
                };
                
                responseContent.textContent = JSON.stringify(result, null, 2);
                
            } catch (error) {
                statusIndicator.className = 'status-indicator status-error';
                statusText.textContent = `‚ùå ${test.name} - ÈîôËØØ`;
                responseContent.textContent = `ÈîôËØØ: ${error.message}`;
            }
        }

        // Ê†ºÂºèÂåñJSON
        function formatJSON() {
            const bodyElement = document.getElementById('body');
            try {
                const json = JSON.parse(bodyElement.value);
                bodyElement.value = JSON.stringify(json, null, 2);
                showMessage('JSONÊ†ºÂºèÂåñÊàêÂäü', 'success');
            } catch (error) {
                showMessage('JSONÊ†ºÂºèÈîôËØØ: ' + error.message, 'error');
            }
        }

        // Âä†ËΩΩÁ§∫‰æãÊï∞ÊçÆ
        function loadExample() {
            const exampleData = DebugConfig.mockData.preview_request;
            document.getElementById('body').value = JSON.stringify(exampleData, null, 2);
            document.getElementById('url').value = '/api/preview/create';
            showMessage('Â∑≤Âä†ËΩΩÁ§∫‰æãÊï∞ÊçÆ', 'info');
        }

        // Ê∏ÖÁ©∫ÊâãÂä®Ë°®Âçï
        function clearManualForm() {
            document.getElementById('url').value = '';
            document.getElementById('body').value = '';
            loadDefaultHeaders();
            document.getElementById('responseContent').textContent = 'Á≠âÂæÖÂèëÈÄÅËØ∑Ê±Ç...';
            document.getElementById('responseStatus').className = 'status-indicator';
            document.getElementById('responseStatusText').textContent = 'ÂáÜÂ§áÂ∞±Áª™';
            showMessage('Ë°®ÂçïÂ∑≤Ê∏ÖÁ©∫', 'info');
        }

        // ÂàùÂßãÂåñÊñá‰ª∂‰∏ä‰º†
        function initializeFileUpload() {
            const fileDropArea = document.getElementById('fileDropArea');
            const fileInput = document.getElementById('fileInput');
            
            // ÁÇπÂáªÈÄâÊã©Êñá‰ª∂
            fileDropArea.onclick = () => fileInput.click();
            
            // Êñá‰ª∂ÈÄâÊã©‰∫ã‰ª∂
            fileInput.onchange = (e) => handleFiles(e.target.files);
            
            // ÊãñÊãΩ‰∫ã‰ª∂
            fileDropArea.ondragover = (e) => {
                e.preventDefault();
                fileDropArea.classList.add('dragover');
            };
            
            fileDropArea.ondragleave = () => {
                fileDropArea.classList.remove('dragover');
            };
            
            fileDropArea.ondrop = (e) => {
                e.preventDefault();
                fileDropArea.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            };
        }

        // Â§ÑÁêÜÈÄâÊã©ÁöÑÊñá‰ª∂
        function handleFiles(files) {
            selectedFiles = Array.from(files);
            updateFileList();
            updateFileDropArea();
        }

        // Êõ¥Êñ∞Êñá‰ª∂ÂàóË°®ÊòæÁ§∫
        function updateFileList() {
            const fileList = document.getElementById('fileList');
            
            if (selectedFiles.length === 0) {
                fileList.innerHTML = '';
                return;
            }
            
            fileList.innerHTML = selectedFiles.map((file, index) => `
                <div class="file-info">
                    <div>
                        <strong>${file.name}</strong>
                        <span style="color: #6c757d; font-size: 12px;">
                            (${(file.size / 1024 / 1024).toFixed(2)} MB)
                        </span>
                    </div>
                    <button class="btn danger" onclick="removeFile(${index})" style="padding: 5px 10px; font-size: 12px;">
                        Âà†Èô§
                    </button>
                </div>
            `).join('');
        }

        // Êõ¥Êñ∞Êñá‰ª∂ÊãñÊãΩÂå∫ÂüüÁä∂ÊÄÅ
        function updateFileDropArea() {
            const fileDropArea = document.getElementById('fileDropArea');
            
            if (selectedFiles.length > 0) {
                fileDropArea.classList.add('has-file');
                fileDropArea.innerHTML = `
                    <p>‚úÖ Â∑≤ÈÄâÊã© ${selectedFiles.length} ‰∏™Êñá‰ª∂</p>
                    <p style="color: #6c757d; font-size: 12px;">ÁÇπÂáªÈáçÊñ∞ÈÄâÊã©ÊàñÊ∑ªÂä†Êõ¥Â§öÊñá‰ª∂</p>
                `;
            } else {
                fileDropArea.classList.remove('has-file');
                fileDropArea.innerHTML = `
                    <p>üìÅ ÊãñÊãΩÊñá‰ª∂Âà∞Ê≠§Â§ÑÊàñÁÇπÂáªÈÄâÊã©Êñá‰ª∂</p>
                    <p style="color: #6c757d; font-size: 12px; margin-top: 10px;">
                        ÊîØÊåÅÂõæÁâáÊ†ºÂºè: JPG, PNG, PDFÁ≠â
                    </p>
                `;
            }
        }

        // ÁßªÈô§Êñá‰ª∂
        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFileList();
            updateFileDropArea();
        }

        // Ê∏ÖÁ©∫Êñá‰ª∂
        function clearFiles() {
            selectedFiles = [];
            document.getElementById('fileInput').value = '';
            updateFileList();
            updateFileDropArea();
            showMessage('Êñá‰ª∂ÂàóË°®Â∑≤Ê∏ÖÁ©∫', 'info');
        }

        // ‰∏ä‰º†Êñá‰ª∂
        async function uploadFiles() {
            if (selectedFiles.length === 0) {
                showMessage('ËØ∑ÂÖàÈÄâÊã©Ë¶Å‰∏ä‰º†ÁöÑÊñá‰ª∂', 'error');
                return;
            }
            
            const uploadBtn = document.getElementById('uploadBtn');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const progressDiv = document.getElementById('uploadProgress');
            const responseContent = document.getElementById('uploadResponseContent');
            
            uploadBtn.disabled = true;
            uploadBtn.innerHTML = 'üì§ ‰∏ä‰º†‰∏≠...';
            progressDiv.classList.remove('hidden');
            
            try {
                const endpoint = document.getElementById('uploadEndpoint').value;
                const paramsText = document.getElementById('uploadParams').value;
                const autoOCR = document.getElementById('autoOCR').checked;
                const asyncProcess = document.getElementById('asyncProcess').checked;
                const keepOriginal = document.getElementById('keepOriginal').checked;
                
                const formData = new FormData();
                
                // Ê∑ªÂä†Êñá‰ª∂
                selectedFiles.forEach((file, index) => {
                    formData.append('files', file);
                });
                
                // Ê∑ªÂä†È¢ùÂ§ñÂèÇÊï∞
                if (paramsText.trim()) {
                    const params = JSON.parse(paramsText);
                    Object.keys(params).forEach(key => {
                        formData.append(key, params[key]);
                    });
                }
                
                // Ê∑ªÂä†ÈÄâÈ°π
                formData.append('auto_ocr', autoOCR);
                formData.append('async_process', asyncProcess);
                formData.append('keep_original', keepOriginal);
                
                const xhr = new XMLHttpRequest();
                
                // ‰∏ä‰º†ËøõÂ∫¶ÁõëÂê¨
                xhr.upload.onprogress = (e) => {
                    if (e.lengthComputable) {
                        const percent = Math.round((e.loaded / e.total) * 100);
                        progressBar.value = percent;
                        progressText.textContent = `${percent}%`;
                    }
                };
                
                // ËØ∑Ê±ÇÂÆåÊàê
                xhr.onload = () => {
                    try {
                        const result = JSON.parse(xhr.responseText);
                        responseContent.textContent = JSON.stringify(result, null, 2);
                        
                        if (xhr.status >= 200 && xhr.status < 300) {
                            showMessage('Êñá‰ª∂‰∏ä‰º†ÊàêÂäü', 'success');
                        } else {
                            showMessage(`‰∏ä‰º†Â§±Ë¥•: ${result.errorMsg || 'Êú™Áü•ÈîôËØØ'}`, 'error');
                        }
                    } catch (error) {
                        responseContent.textContent = xhr.responseText;
                        showMessage('‰∏ä‰º†Â§±Ë¥•: ÂìçÂ∫îÊ†ºÂºèÈîôËØØ', 'error');
                    }
                };
                
                // ËØ∑Ê±ÇÈîôËØØ
                xhr.onerror = () => {
                    showMessage('‰∏ä‰º†Â§±Ë¥•: ÁΩëÁªúÈîôËØØ', 'error');
                    responseContent.textContent = 'ÁΩëÁªúÈîôËØØ';
                };
                
                // ÂèëÈÄÅËØ∑Ê±Ç
                xhr.open('POST', endpoint);
                xhr.send(formData);
                
            } catch (error) {
                showMessage(`‰∏ä‰º†Â§±Ë¥•: ${error.message}`, 'error');
                responseContent.textContent = `ÈîôËØØ: ${error.message}`;
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = 'üì§ ‰∏ä‰º†Êñá‰ª∂';
                
                setTimeout(() => {
                    progressDiv.classList.add('hidden');
                    progressBar.value = 0;
                    progressText.textContent = '0%';
                }, 2000);
            }
        }

        // ÂàõÂª∫È¢ÑÂÆ°ÊµãËØï
        async function createPreviewTest() {
            // ÂÆûÁé∞È¢ÑÂÆ°ÂàõÂª∫ÈÄªËæë
            showMessage('È¢ÑÂÆ°ÊµãËØïÂäüËÉΩÂºÄÂèë‰∏≠...', 'info');
        }

        // Êü•ËØ¢È¢ÑÂÆ°ÊµãËØï
        async function queryPreviewTest() {
            // ÂÆûÁé∞È¢ÑÂÆ°Êü•ËØ¢ÈÄªËæë
            showMessage('È¢ÑÂÆ°Êü•ËØ¢ÂäüËÉΩÂºÄÂèë‰∏≠...', 'info');
        }

        // ËΩÆËØ¢È¢ÑÂÆ°Áä∂ÊÄÅ
        function pollPreviewStatus() {
            showMessage('Áä∂ÊÄÅËΩÆËØ¢ÂäüËÉΩÂºÄÂèë‰∏≠...', 'info');
        }

        // ÂÅúÊ≠¢ËΩÆËØ¢
        function stopPolling() {
            if (pollingInterval) {
                clearInterval(pollingInterval);
                pollingInterval = null;
                showMessage('Â∑≤ÂÅúÊ≠¢Áä∂ÊÄÅËΩÆËØ¢', 'info');
            }
        }

        // ËøêË°åÊâπÈáèÊµãËØï
        async function runBatchTest() {
            showMessage('ÊâπÈáèÊµãËØïÂäüËÉΩÂºÄÂèë‰∏≠...', 'info');
        }

        // ÂÅúÊ≠¢ÊâπÈáèÊµãËØï
        function stopBatchTest() {
            batchTestAborted = true;
            showMessage('ÊâπÈáèÊµãËØïÂ∑≤ÂÅúÊ≠¢', 'info');
        }

        // ÊòæÁ§∫Ê∂àÊÅØ
        function showMessage(message, type = 'info') {
            const messageContainer = document.getElementById('statusMessage');
            messageContainer.innerHTML = `
                <div class="message ${type}">
                    ${message}
                </div>
            `;
            
            setTimeout(() => {
                messageContainer.innerHTML = '';
            }, 3000);
        }
    </script>
</body>
</html> 